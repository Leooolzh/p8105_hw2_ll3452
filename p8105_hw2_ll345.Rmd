Assignment 2
================
Leo Liu
Sept 24 2020

This is my solution to Assignment 2

```{r}
library(tidyverse)
library(readxl)
library(haven)
```

## Problem 1

Read the Mr. Trashwheel dataset

```{r}
trashwheel_df = 
   read_xlsx(
     "./Trash-Wheel-Collection-Totals-8-6-19.xlsx",
     range = cell_cols("A:N")) %>% 
  janitor::clean_names() %>% 
  drop_na(dumpster) %>% 
  mutate(
    sports_balls = round(sports_balls)
  )

```

Read Precipitation data

```{r}
precip_2018 =
  read_excel("./Trash-Wheel-Collection-Totals-8-6-19.xlsx",
             sheet = "2018 Precipitation",
             skip = 1) %>% 
  janitor::clean_names() %>% 
  drop_na(month) %>% 
  mutate(year = 2018) %>% 
  relocate(year)

precip_2017 =
  read_excel("./Trash-Wheel-Collection-Totals-8-6-19.xlsx",
             sheet = "2017 Precipitation",
             skip = 1) %>% 
  janitor::clean_names() %>% 
  drop_na(month) %>% 
  mutate(year = 2017) %>% 
  relocate(year)
```

Combine the two annual precipitation

```{r}
month_df = 
  tibble(
    month = 1:12,
    month_name = month.name
  )

precip_df = 
  bind_rows(precip_2018, precip_2017)

left_join(precip_df, month_df, by = "month")
```


Problem 2

```{r}
nyc_transit_df = 
  read_csv("./NYC_Transit_Subway_Entrance_And_Exit_Data.csv") %>% 
  janitor:: clean_names() %>% 
  select(line, station_name, station_latitude, station_longitude, starts_with("route"), entry, vending, entrance_type, ada) %>% 
  mutate(
    entry = ifelse(entry == "YES", 1, 0)
  )
view(nyc_transit_df)
```

The nyc_transit dataset contains 19 variables. 

There are 465 distinct stations
84 are ADA compliant
5 in 465 entries without vending allow entrance
```{r}
distinct_nyc_transit =
  distinct(nyc_transit_df,
           line,
           station_name,
           .keep_all = TRUE
  )

nrow(distinct_nyc_transit)

filter(distinct_nyc_transit, ada == TRUE)
```

Wide format to long format

We find that 60 distinct stations serve A train, and 924 distinct stations are ADA compliant.
```{r}
distinct_nyc_longer = 
  distinct_nyc_transit %>% 
  mutate(route8 = as.character(route8),
         route9 = as.character(route9),
         route10 = as.character(route10),
         route11 = as.character(route11)) %>% 
  pivot_longer(
    route1:route11,
    names_to = "routes",
    values_to = "trains") %>% 
  separate(routes, 
           into = c("route_name", "route_number"), 
           sep = 5)

filter(distinct_nyc_longer, trains == "A") %>% 
  nrow()

filter(distinct_nyc_longer, ada == TRUE) %>% 
  nrow()

```

Problem 3

```{r}
pols_df = 
  read_csv("./fivethirtyeight_datasets/pols-month.csv") %>% 
  janitor::clean_names() %>% 
  separate(mon, into = c("year", "month", "day"), sep = "-") %>% 
  mutate(
    month = month.name[as.numeric(month)],
    president = ifelse(prez_gop == 1, "republican", "democrat")) %>% 
    select(-prez_gop, -prez_dem
  )
   
```

Now read the snp.csv

```{r}
snp_df = 
  read_csv("./fivethirtyeight_datasets/snp.csv") %>% 
  janitor:: clean_names() %>% 
  separate(date,
           into = c("day", "month", "year"), sep = "/") %>% 
  arrange(year, month, day) %>% 
  mutate(
    month = month.name[as.numeric(month)]) %>% 
  select(year, month, day, close)
  
```
 
 Next, we read the unemployment.csv
 
```{r}
unemp_df = 
  read_csv("./fivethirtyeight_datasets/unemployment.csv") %>% 
  janitor:: clean_names() %>% 
  pivot_longer(jan:dec,
               names_to = "month",
               values_to = "unemployment_rate") %>% 
  mutate(month = recode(month, `jan` = "January",
                        `feb` = "February",
                        `mar` = "March",
                        `apr` = "April",
                        `may` = "May",
                        `jun` = "June",
                        `jul` = "July",
                        `aug` = "August",
                        `sep` = "September",
                        `oct` = "October",
                        `nov` = "November",
                        `dec` = "December"),
         year = as.character(year))
  
```

Join them
Note that the days in the pols_df are all 15, but no 15 exists in the snp_df. So the "close" column in snp_df does not show up in the joint data frame. 
```{r}
snp_and_pols_df = 
  left_join(pols_df, snp_df)

final_df =
  left_join(snp_and_pols_df, unemp_df)
```

